# 入库管理功能规范

> 模块名称：入库管理 (Inbound Management)
> 版本：v1.0
> 创建日期：2026-01-04
> 状态：待实现

---

## 1. 功能概述

入库管理模块负责处理商品入库业务，包括入库单的创建、审核、查询等功能。入库操作会自动增加对应商品的库存数量。

### 核心功能
- 入库单 CRUD 操作
- 自动生成入库单号
- 入库自动增加库存
- 供应商信息管理
- 入库单状态管理

---

## 2. 业务规则

### 2.1 入库单号生成规则
- **格式**：`IN` + `yyyyMMdd` + `4位序号`
- **示例**：`IN202601040001`
- **规则**：
  - 单号前缀固定为 `IN`
  - 日期部分为当天日期（yyyyMMdd）
  - 序号部分每天重置，从 0001 开始递增
  - 单号全局唯一

### 2.2 入库数量规则
- 入库数量必须 > 0
- 入库数量不能超过最大限制（999999）

### 2.3 入库状态规则
- **待审核 (PENDING)**：新创建的入库单，待审核状态
- **已审核 (APPROVED)**：已审核通过的入库单，审核后自动增加库存
- **已作废 (VOID)**：已作废的入库单，不产生库存变化

### 2.4 库存处理规则
- 只有"已审核"状态的入库单才会增加库存
- 入库单审核通过后，自动增加对应商品的库存数量
- 作废的入库单不影响库存

### 2.5 供应商规则
- 供应商名称必填
- 供应商名称长度：1-100 字符

---

## 3. 数据模型

### 3.1 入库单表 (t_inbound)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 主键 |
| inbound_no | VARCHAR(20) | NOT NULL, UNIQUE | 入库单号 |
| product_id | BIGINT | NOT NULL, FK | 商品ID |
| quantity | INT | NOT NULL, >0 | 入库数量 |
| supplier | VARCHAR(100) | NOT NULL | 供应商名称 |
| inbound_date | DATETIME | NOT NULL | 入库日期 |
| status | TINYINT | NOT NULL, DEFAULT 0 | 状态：0-待审核 1-已审核 2-已作废 |
| remark | VARCHAR(500) | | 备注 |
| created_by | VARCHAR(50) | | 创建人 |
| created_at | DATETIME | NOT NULL | 创建时间 |
| updated_at | DATETIME | | 更新时间 |
| approved_by | VARCHAR(50) | | 审核人 |
| approved_at | DATETIME | | 审核时间 |

### 3.2 索引设计
- PRIMARY KEY: `id`
- UNIQUE INDEX: `uk_inbound_no` ON `inbound_no`
- INDEX: `idx_product_id` ON `product_id`
- INDEX: `idx_inbound_date` ON `inbound_date`
- INDEX: `idx_status` ON `status`

---

## 4. API 接口设计

### 4.1 创建入库单
```
POST /api/inbound
```

**请求体：**
```json
{
  "productId": 1,
  "quantity": 100,
  "supplier": "供应商A",
  "inboundDate": "2026-01-04T10:00:00",
  "remark": "备注信息"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "入库单创建成功",
  "data": {
    "id": 1,
    "inboundNo": "IN202601040001",
    "productId": 1,
    "quantity": 100,
    "supplier": "供应商A",
    "status": 0,
    "createdAt": "2026-01-04T10:00:00"
  }
}
```

### 4.2 获取入库单详情
```
GET /api/inbound/{id}
```

### 4.3 获取入库单列表（分页）
```
GET /api/inbound?page=1&size=10&productId=&status=&startDate=&endDate=
```

**查询参数：**
- `page`: 页码（默认 1）
- `size`: 每页大小（默认 10）
- `productId`: 商品ID（可选）
- `status`: 状态（可选）
- `startDate`: 开始日期（可选）
- `endDate`: 结束日期（可选）

### 4.4 更新入库单
```
PUT /api/inbound/{id}
```

**限制：** 只有"待审核"状态的入库单可以修改

### 4.5 删除入库单
```
DELETE /api/inbound/{id}
```

**限制：** 只有"待审核"状态的入库单可以删除

### 4.6 审核入库单
```
PATCH /api/inbound/{id}/approve
```

**业务逻辑：**
1. 验证入库单状态为"待审核"
2. 更新状态为"已审核"
3. 增加对应商品的库存数量
4. 记录审核人和审核时间

### 4.7 作废入库单
```
PATCH /api/inbound/{id}/void
```

**限制：** 只有"待审核"状态的入库单可以作废

---

## 5. 前端页面设计

### 5.1 入库单列表页面

**页面元素：**
- 搜索栏：
  - 商品选择（下拉）
  - 状态筛选（下拉）
  - 日期范围选择
  - 搜索按钮
  - 重置按钮
- 操作按钮：
  - 新增入库单按钮
- 数据表格：
  - 列：入库单号、商品名称、入库数量、供应商、入库日期、状态、操作
  - 操作：查看详情、编辑（仅待审核）、删除（仅待审核）、审核（仅待审核）、作废（仅待审核）
- 分页组件

**状态标签样式：**
- 待审核：灰色 / 警告色
- 已审核：绿色 / 成功色
- 已作废：红色 / 危险色

### 5.2 入库单表单对话框

**表单字段：**
- 商品（必填，级联选择）
- 入库数量（必填，数字输入，>0）
- 供应商（必填，文本输入）
- 入库日期（必填，日期时间选择）
- 备注（可选，文本域）

**表单验证规则：**
- 商品：必须选择有效的启用状态商品
- 入库数量：必填，>0，整数
- 供应商：必填，1-100字符
- 入库日期：必填

---

## 6. 异常处理

### 6.1 业务异常

| 异常场景 | 错误码 | 错误信息 |
|----------|--------|----------|
| 商品不存在 | 400 | 商品不存在或已禁用 |
| 入库数量不合法 | 400 | 入库数量必须大于0 |
| 供应商名称为空 | 400 | 供应商名称不能为空 |
| 入库单不存在 | 404 | 入库单不存在 |
| 入库单已审核 | 400 | 入库单已审核，无法修改 |
| 入库单已作废 | 400 | 入库单已作废，无法操作 |

### 6.2 系统异常
- 单号生成失败
- 库存更新失败
- 数据库异常

---

## 7. 测试用例

### 7.1 正常场景
- 创建入库单，验证单号自动生成
- 审核入库单，验证库存自动增加
- 查询入库单列表，验证分页功能
- 按商品、状态、日期筛选入库单
- 修改待审核状态的入库单
- 删除待审核状态的入库单
- 作废待审核状态的入库单

### 7.2 异常场景
- 创建不存在的商品入库单
- 创建入库数量 <= 0 的入库单
- 创建供应商为空的入库单
- 修改已审核的入库单
- 删除已审核的入库单
- 重复审核入库单

### 7.3 边界条件
- 入库数量边界值：1, 999999
- 单号序号边界：0001, 9999
- 日期边界：跨天单号重置

---

## 8. 依赖关系

### 8.1 依赖模块
- **商品管理**：获取商品信息，验证商品有效性
- **库存管理**：审核入库单时增加库存

### 8.2 被依赖模块
- **统计报表**：入库数据统计

---

## 9. 实现优先级

| 优先级 | 功能 |
|--------|------|
| P0 | 创建入库单、自动生成单号 |
| P0 | 审核入库单、自动增加库存 |
| P1 | 查询入库单列表（分页） |
| P1 | 修改、删除入库单 |
| P2 | 作废入库单 |

---

## 10. 验收标准

- [ ] 能够创建入库单，单号格式正确且唯一
- [ ] 审核入库单后，对应商品库存自动增加
- [ ] 只有待审核状态的入库单可以修改和删除
- [ ] 查询列表支持按商品、状态、日期筛选
- [ ] 分页功能正常
- [ ] 所有业务异常都有明确的错误提示

---

**文档版本历史**
- v1.0 (2026-01-04): 初始版本
